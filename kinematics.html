<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>upkie: Kinematics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">upkie<span id="projectnumber">&#160;10.0.0</span>
   </div>
   <div id="projectbrief">Open-source wheeled biped robots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('kinematics.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Kinematics </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#frames">Frames</a><ul><li class="level2"><a href="#anchor-frames">Anchor frames</a></li>
</ul>
</li>
<li class="level1"><a href="#ars">Attitude reference system</a><ul><li class="level2"><a href="#imu-frame">IMU frame</a></li>
</ul>
</li>
<li class="level1"><a href="#joint-limits">Joint limits</a></li>
<li class="level1"><a href="#model-conventions">Model conventions</a><ul><li class="level2"><a href="#autotoc_md10">Link and joint names</a></li>
<li class="level2"><a href="#virtual-links">Virtual links</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_kinematics"></a></p>
<p >This page is about the geometry and joint properties of Upkies. Mechanics and electronics are discussed in the <a href="https://github.com/upkie/upkie/wiki">Hardware wiki</a>.</p>
<h1><a class="anchor" id="frames"></a>
Frames</h1>
<h2><a class="anchor" id="anchor-frames"></a>
Anchor frames</h2>
<p ><img src="anchor-frames.jpg" alt="Locations of anchor frame" height="150" align="right" class="inline"/></p>
<p >Anchor frames are attached to the stator of the ankle on each leg. Their orientation compared to the stator frame is such that they are aligned with the torso in the neutral configuration.</p>
<p >Right-click on the image to the right and open it in a new tab/window to see the frame orientation better. This image was generated by running <code>python examples/display_frames.py --filter contact</code> from the <a href="https://github.com/upkie/upkie_description">upkie_description</a> repository.</p>
<h1><a class="anchor" id="ars"></a>
Attitude reference system</h1>
<p >The attitude reference system (ARS) frame is an inertial frame of reference used by the IMU filter onboard the pi3hat. It has its x-axis pointing forward, y-axis pointing to the right and z-axis pointing down (<a href="https://github.com/mjbots/pi3hat/blob/ab632c82bd501b9fcb6f8200df0551989292b7a1/docs/reference.md#orientation">details</a>). This is not the convention we use in the world frame, and the rotation matrix from the ARS frame to the world frame is:</p>
<p >\(
R_{WA} = \begin{bmatrix}
    1 &amp; 0 &amp; 0 \\
    0 &amp; -1 &amp; 0 \\
    0 &amp; 0 &amp; -1 \\
\end{bmatrix}
\)</p>
<h2><a class="anchor" id="imu-frame"></a>
IMU frame</h2>
<p ><img src="imu-frame.jpg" alt="Location of the IMU frame" height="150" align="right" class="inline"/></p>
<p >The IMU frame has the orientation of the pi3hat IMU:</p>
<ul>
<li><b>x-axis:</b> from the IMU towards the back of the robot (CAN/HDMI connectors on the Raspberry Pi).</li>
<li><b>y-axis:</b> from the IMU towards the left of the robot (USB ports of the Raspberry Pi).</li>
<li><b>z-axis:</b> from the IMU towards the wheels of the robot (from the Raspberry Pi towards the pi3hat).</li>
</ul>
<p >Right-click on the image to the right and open it in a new tab/window to see the frame orientation better. This image was generated by running <code>python examples/display_frames.py --only imu</code> from the <a href="https://github.com/upkie/upkie_description">upkie_description</a> repository.</p>
<h1><a class="anchor" id="joint-limits"></a>
Joint limits</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Joint   </th><th class="markdownTableHeadNone">Limit   </th><th class="markdownTableHeadNone">Value (Â±)   </th><th class="markdownTableHeadNone">Why?    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Hip   </td><td class="markdownTableBodyNone">Position   </td><td class="markdownTableBodyNone">1.26 rad   </td><td class="markdownTableBodyNone">Geometry: cables fully stretched    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Hip   </td><td class="markdownTableBodyNone">Velocity   </td><td class="markdownTableBodyNone">28.8 rad/s   </td><td class="markdownTableBodyNone">See qdd100 details below    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Hip   </td><td class="markdownTableBodyNone">Torque   </td><td class="markdownTableBodyNone">16.0 Nm   </td><td class="markdownTableBodyNone">Peak torque (&lt; 1 s) from the <a href="https://mjbots.com/products/qdd100-beta-3">qdd100 spec</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Knee   </td><td class="markdownTableBodyNone">Position   </td><td class="markdownTableBodyNone">2.51 rad   </td><td class="markdownTableBodyNone">Geometry: wheels touching hip actuators.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Knee   </td><td class="markdownTableBodyNone">Velocity   </td><td class="markdownTableBodyNone">28.8 rad/s   </td><td class="markdownTableBodyNone">See qdd100 details below    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Knee   </td><td class="markdownTableBodyNone">Torque   </td><td class="markdownTableBodyNone">16 Nm   </td><td class="markdownTableBodyNone">Peak torque (&lt; 1 s) from the <a href="https://mjbots.com/products/qdd100-beta-3">qdd100 spec</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Wheel   </td><td class="markdownTableBodyNone">Position   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">No limit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Wheel   </td><td class="markdownTableBodyNone">Velocity   </td><td class="markdownTableBodyNone">111 rad/s   </td><td class="markdownTableBodyNone">See mj5208 details below    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Wheel   </td><td class="markdownTableBodyNone">Torque   </td><td class="markdownTableBodyNone">1.7 Nm   </td><td class="markdownTableBodyNone">See mj5208 details below   </td></tr>
</table>
<p ><b>For qdd100's:</b> peak velocities are <a href="https://mjbots.com/products/qdd100-beta-3">rated</a> as 3,600 dps at 36 V and 2,300 dps at 24 V. Assuming a linear velocity-voltage relationship (which is a big assumption, for instance the actual maximum velocity will also depend on <a href="https://github.com/mjbots/moteus/blob/main/docs/reference.md#servopwm_rate_hz"><code>servo.pwm_rate_hz</code></a>) leads to 1,650 dps at the 18 V of the <a href="https://github.com/upkie/upkie/wiki/Bill-of-materials">RYOBI batteries used on Upkie</a>, or equivalently 28.8 rad/s after conversion and rounding.</p>
<p ><b>For mj5208's:</b> peak velocities from the <a href="https://mjbots.com/products/mj5208">mj5208 spec</a> are rated as 7,500 rpm, or approximately 785 rad/s. Multiplying by the wheel radius of your typical Upkie (between 5 and 6 cm), we obtain a ground speed comparable to that of a car on a highway. We scale this down a notch! Backtracking from a top ground speed at 20 km/h, we obtain a maximum velocity around 111 rad/s.</p>
<h1><a class="anchor" id="model-conventions"></a>
Model conventions</h1>
<p >There are some conventions used in the URDF description of the robot model. You should read this section if you are planning on customizing the default <a href="https://github.com/upkie/upkie_description/">upkie_description</a>. If you are creating your own wheeled-biped description and plan on running Upkie's software on it, head over to [this section](<a class="el" href="dev-notes.html#custom-hardware">Custom hardware</a>}.</p>
<p >In what follows, we assume you are familiar with the informal URDF standard from the ROS wiki, in particular the <a href="https://wiki.ros.org/urdf/XML/joint">urdf/XML/joint</a> and <a href="https://wiki.ros.org/urdf/XML/link">urdf/XML/link</a> pages.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Link and joint names</h2>
<p >Links and joints are grouped by "assemblies". We can recognize assemblies in link and joint names:</p>
<ul>
<li>A link is named <code>&lt;assembly&gt;_&lt;identifier&gt;</code>, for example <code>left_hip_qdd100_stator</code> denotes the stator of the qdd100 of the left hip.</li>
<li>A fixed joint is named <code>&lt;child_link&gt;_fix</code>, for instance the <code>left_hip_qdd100_stator_fix</code> that attaches the qdd100 stator of the left-hip assembly to the torso.</li>
<li>A revolute joint is named directly based on its side and role, for example <code>left_hip</code> or <code>right_wheel</code>.</li>
</ul>
<p >Note that the moteus convention is that positive angles correspond to clockwise rotations when looking at the rotor / back of the moteus board. This is opposite to the URDF default, so our motor stator-rotor joint axes are aligned with the -z axis of the joint frame. See <a href="https://jpieper.com/2021/04/30/moteus-direction-configuration/">moteus direction configuration</a> for details.</p>
<h2><a class="anchor" id="virtual-links"></a>
Virtual links</h2>
<p >Virtual links have a net mass of 1 gram. Setting the mass of a virtual link to zero prevents the base link from free-floating in Bullet. Since our description does not account for screws and cables anyway, the additional 1 gram per virtual link should not make a significant difference.</p>
<p >Virtual links should also contain a visual geometry (see <a href="https://github.com/upkie/upkie_description/pull/19#issuecomment-2259933854">this comment</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
